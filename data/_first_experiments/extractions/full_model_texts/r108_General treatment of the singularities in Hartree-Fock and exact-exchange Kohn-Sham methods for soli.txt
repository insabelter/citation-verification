I. INTRODUCTION
In recent years exact exchange (EXX) Kohn-Sham (KS) methods for solids became increasingly popular 1,2,3,4,5,6 as alternative to conventional KS procedures based on the local density approximation  7, 8  (LDA) or generalised gradient approximations (GGAs).  9  EXX-KS methods treat both the exchange energy as well as the local KS exchange potential, not to be confused with the non-local Hartree-Fock exchange potential, exactly. This means they constitute a systematic improvement over LDA and GGA methods in the sense that only the correlation energy and potential, i.e., contributions of higher order in the electron-electron interaction, need to be approximated whereas the terms of first order in the square e 2 of the electron charge, i.e., the Coulomb and exchange energy and potential, are treated exactly.  10  Because exchange and Coulomb potential and energy are treated exactly unphysical selfinteractions contained in the Coulomb energy and potential are completely cancelled by the exchange energy and potential. EXX methods therefore are free of Coulomb self-interactions. As a result EXX band structures and in particular band gaps are strongly improved compared to those from LDA or GGA methods. Indeed for medium gap semiconductors EXX methods yield band gaps 2 which are very close to the experimental ones  11  despite the fact that the correlation potential needs to be neglected or approximated by conventional LDA or GGA functionals, and despite the fact that the KS band gap does not account for the derivative discontinuity  12, 13  of the band gap at integer electron numbers. A second first-principles approach besides the family of density-functional methods is the Hartree-Fock (HF) method.  14, 15  Recently, there has been an increasing interest in HF methods for solids as basis for higher level approaches like, e.g., Møller-Plesset,  16, 17  coupled cluster  18  or multireference configuration interaction  19  methods. Both in the EXX and in the HF formalism the exchange energy contains divergent terms.  20  In the limit of an infinite system, i.e., the limit of an infinite number of k points, the divergencies are integrable. In this limit the exchange energy is therefore well-defined. Moreover, corresponding divergencies also occur in the matrix elements of the non-local exchange operator which is required in the HF self-consistency process and can be used in the construction of the local KS exchange potential. 1,2 Also here the divergencies are integrable in the limit of an infinite number of k points. The question arises how to treat these divergencies in practical calculations which necessarily take into account only a finite number of k points. Indeed, in order to keep the computational effort as low as possible, it is preferable to keep the number of k points as low as possible. This, however, is possible only if an adequate treatment of the singularities is available. Moreover, such a treatment of the singularities should be computationally efficient and ideally its implementation should not require much programming effort. Gygi and Baldereschi 20 presented such a method for the case of zincblende (fcc) structures. Wenzien et al.  21  further generalised the method to simple cubic, bcc, hexagonal, and orthorhombic structures. For other crystal structures such simple and straightforward method, to our knowledge, is still lacking and alternative approaches  15, 22, 23  are more involved. In Refs. [15,22], e.g., a general treatment of the singularities is presented. This method, however, is somewhat laborious because it requires a quadrature over reciprocal lattice vectors at each k points. This quadrature formally has to run over an infinite number of reciprocal lattice vectors which in practice needs to be approximated by a finite summation. Thus there is demand for a simple, efficient treatment of the singularities, that is applicable to arbitrary crystal structures. In this article we present a simple, efficient, and general treatment of the singularities in Hartree-Fock and exact-exchange Kohn-Sham methods for periodic systems, which extends the approach of Gygi and Baldereschi 20 to systems with arbitrary lattice parameters. The derivation of this treatment of the singularities is accompanied by an analysis of the singularities and demonstrates the simplicity of the suggested method for handling these singularities. In order to demonstrate the applicability of the approach we present results for the symmetric diamond (fcc) structure (2 carbon atoms) as well as for trans-polyacetylene (4 carbons and 4 hydrogens in its crystalline unit cell). Polyacetylene has monoclinic symmetry P 2 1 /a, i.e., non-orthogonal lattices, 24 and constitutes a simple example of an organic polymer. The article is organized as follows. In Section II the general treatment of the divergent terms in EXX and HF methods is derived and discussed. Section III unwraps the results for diamond and trans-polyacetylene. Section IV concludes.

II. TOTAL ENERGY WITHIN THE EXX FORMALISM
We start by considering the expressions for the total electronic energy E 0 within the Kohn-Sham (KS) and the Hartree-Fock (HF) schemes. Within the KS formalism the total ground state energy is decomposed into the non-interacting kinetic energy T s , the Coulomb energy U, the exchange energy E x , the correlation energy E c , and the interaction energy with the external potential, V ext : 7 E 0 = T s + U + E x + E c + dr V ext (r)ρ 0 (r). (1) The non-interacting kinetic energy T s is evaluated exactly via the KS orbitals. The contributions U and drV ext (r)ρ 0 (r) also can be calculated exactly for a given electron density and thus also for the ground state electron density ρ 0 . The correlation energy E c in almost all KS schemes is evaluated approximately within the LDA 8 or the GGA.  9  The exchange energy E x can either be evaluated via the LDA or the GGA within a conventional KS scheme, or exactly within the EXX-KS scheme.  10  The HF total energy, on the other hand, is decomposed into E 0 = T + U + E x + dr V ext (r)ρ HF (r). (2) Within HF schemes all contributions of the energy are usually treated exactly: the kinetic energy T and the exchange energy E x via the HF orbitals, and U and drV ext (r)ρ HF (r) via the HF electron density ρ HF . The exact-exchange energy E x per unit cell for a crystalline solid, either for the KS or HF formalisms, is given by: E x = - 1 N k occ. vk occ. wq Ω dr Ω dr ′ φ † vk (r)φ wq (r)φ † wq (r ′ )φ vk (r ′ ) |r -r ′ | , (3) where both summations run through all occupied single-particle wave functions, i.e., orbitals φ vk and φ wk for each k point in the Brillouin zone (BZ). All orbitals are assumed to be normalised with respect to the crystal volume Ω = N k V where V designates the volume of the unit cell, and N k denotes the number of k points. We implicitely treat the spin via appropriate prefactors in summations and consider for simplicity non-spin polarised calculations. The Coulomb interaction term, 1 |r-r ′ | in Eq. (3), has to be treated taking into account periodic boundary conditions. Note that, despite the fact that the expression for the exchange energy in terms of one-particle functions is identical in the KS and HF case, the KS and HF exchange energies remain different because their respective one-particle functions are constructed using two different scheme: KS uses a local exchange operator while HF uses a non-local exchange operator. After expressing the product of one-particle functions as φ † wq (r)φ vk (r) = 1 Ω G Y wq,vk (G)e i(G+k-q)•r , (4) with Y wq,vk (G) = Ω dr e -i(G+k-q)•r φ † wq (r) φ vk (r) (5) one obtains the following expression for the exchange energy per unit cell E x = - 4π N k Ω vk wq G Y * wq,vk (G) Y wq,vk (G) |G + k -q| 2 , ( 6 ) if the following relation is taken into account Ω dr Ω dr ′ e -iG•r e iG ′ •r ′ |r -r ′ | = 4πΩ |G| 2 δ GG ′ , (7) which holds due to translational symmetry. Expression (6) contains singular terms, namely those with G = 0, k = q, and v = w. Note that when v = w no singularities occur for any value of G and k. This is due to the relation Y wk,vk (0) = δ wv (8)   which holds because Eq. (  5 ) that defines Y wq,vk (0) in the case where G = 0 and k = q just turns into the orthonormality condition for the one-particle functions. Thus, contributions with G = 0, k = q, and v = w vanish because the plane wave representations of the products φ † wk (r)φ vk (r) with v = w do not contain contributions from a plane wave with G = 0. [This means that for v = w no singularities are present in Eq. (6). Therefore, stricktly speaking, Eq. (6) needs to be modified in a way that for v = w singular terms are no longer present]. Due to the presence of the singularities described above the exchange energy is welldefined only in the limit of an infinite number of unit cells, i.e., for N k → ∞. In this case, the summations over k and q turn into integrals over the BZ and Eq. (6) for the exchange energy assumes the form E x = - 4π N k Ω Ω 2 (2π) 6 v BZ dk w BZ dq G Y * wq,vk (G) Y wq,vk (G) |G + k -q| 2 . ( 9 ) The singularities in integral (9) are integrable. Therefore, the exchange energy is now welldefined. Adopting an idea of Gygi and Baldereschi  20  we now manipulate the contributions on the right hand side of Eq. (  9 ) with G = 0 and v = w, i.e., those contributions which contain the integrable singularities, by adding and subtracting a function f (q) which shall obey the three following conditions: (i) f (q) is periodic within the reciprocal lattice, (ii) f (q) diverges as 1/q 2 for q → 0 and is smooth elsewhere, and (iii) f (q) = f (-q). This leads to - 4π N k Ω Ω 2 (2π) 6 v BZ dk BZ dq Y * vq,vk (0) Y vq,vk (0) |k -q| 2 = - 4π N k Ω Ω 2 (2π) 6 v BZ dk BZ dq Y * vq,vk (0) Y vq,vk (0) |k -q| 2 -f (k -q) - 4π N k Ω Ω 2 (2π) 6 v BZ dk BZ dq f (k -q) ≈ - 4π N k Ω v k q =k Y * vq,vk (0) Y vq,vk (0) |k -q| 2 -f (k -q) - 4π N k Ω Ω 2 (2π) 6 v BZ dk BZ dq f (q) = - 4π N k Ω v k q =k Y * vq,vk (0) Y vq,vk (0) |k -q| 2 + 4πN v N k Ω k q =k f (k -q) -N v 4π (2π) 3 BZ dq f (q) = - 4π N k Ω v k q =k Y * vq,vk (0) Y vq,vk (0) |k -q| 2 + N v [ F -F ], (10) where F = 1 N k k Fk = 1 N k k 4π Ω q =k f (k -q) (11) and F = 4π (2π) 3 BZ dq f (q). ( 12 ) The function Fk in Eq. (  11 ) is given by Fk = 4π Ω q =k f (k -q) . (13) In Eq. (  10 ) N v designates the number of valence bands, which comes from the summation over the valence bands in the two terms containing the function f . We also used condition (ii) for the function f and Eq. (  8 ) that require Y * vq,vk (0) Y vq,vk (0)/|k -q| 2 -f (kq) for any given k to be a smooth function of q that equals zero at q = k. Therefore, the first integral over q and k after the first equality sign of Eq. (  10 ) can be evaluated by summations over the finite grid of k points omitting the terms with q = k. Due to the periodicity and inversion symmetry of f (q) [condition (i) and (iii) for f ] the integrals of f (k-q) over the BZ can be replaced by BZ integrals of f (q). Furthermore, for the case of a uniform grid of k points the function F of Eq. (  11 ) simplifies to F = 4π Ω q =0 f (q). ( 14 ) The evaluation of the exchange energy can now be done according to E x = - 4π N k Ω v,k w,q =k G Y * wq,vk (G) Y wq,vk (G) |G + k -q| 2 - 4π N k Ω v,k w G =0 Y * wk,vk (G) Y wk,vk (G) |G| 2 +N v [ F -F ] . (15) This implies that for the evaluation of the exchange energy the singular terms in the original expression (6) can first simply be omitted and then be taken into account by N v [ F -F ], i.e., by adding N v [ F -F ] to the exchange energy obtained if the singular terms are simply omitted. The correction is calculated only once before the self-consistency procedure. In fact, the correction N v [ F -F ] depends only on the unit cell lattice vectors, and thus in particular on the unit cell volume V , and on the number N k and the positions of the k points. It does not depend on the number, type, or positions of the atoms within the unit cell, and does not depend on the one-particle wave functions. This has obvious advantages for atomic relaxations at fixed unit cell volumes and fixed lattices. The whole scheme, of course, hinges on the availability of a suitable function f (q). For fcc systems such a function was given by Gygi and Baldereschi.  20  For sc, bcc, hexagonal, and orthorhombic systems Wenzien 21 presented such functions. Here we suggest the following function f for arbitrary crystal structures: f (q) = 1 1/(2π) 2 4 3 j=1 [b j sin(a j • q/2)] • [b j sin(a j • q/2)] + 2 3 j=1 [b j sin(a j • q)] • [b j+1 sin(a j+1 • q)] -1 . ( 16 ) The b j (with b 4 ≡ b 1 for a compact formulation accounting for cyclic permutations) are the reciprocal lattice vectors, and the a j (with a 4 ≡ a 1 ) are the corresponding lattice vectors spanning the unit cell. The coefficient 1/(2π) 2 arises from the factor 2π contained in the Taylor expansion of the trigonometric functions, because a j •q implicitely contains a j •b j = 2π if q is expressed as q = j q j b j , with q j describing the components of q with respect to reciprocal lattice vectors. The function (  16 ) by construction has the required periodicity of the reciprocal unit cell. Expansion into a Taylor series with respect to the cartesian components q x , q y , and q z , or equivalently with respect to q 1 , q 2 , and q 3 , the components of q referring to the reciprocal lattice, furthermore shows that it diverges as 1/q 2 for q → 0. Therefore, f (q) satisfies requirements (i)-(iii) for any type of (linearly independent) lattice parameters: a 1 , a 2 , and a 3 . The integration over the BZ of the function (  16 ) required for obtaining the correction F in Eq. (  12 ) can easily be carried out numerically on an adaptive grid using an iterative algorithm. To this end, we place the reciprocal lattice centered symmetrically around q = 0. In the first iteration we generate a regular (2N + 1) × (2N + 1) × (2N + 1)-grid with the number N being a multiple of 3, typically N = 60.  25  The grid points shall be labeled q ℓmn with -N ≤ ℓ ≤ N, -N ≤ m ≤ N, and -N ≤ n ≤ N, with the point q 000 located at the origin of the reciprocal lattice. We then divide the unit cell into an inner part given by a cell in reciprocal space which again is centered symmetrically around q = 0, and which is defined by lattice vectors being one third of the original reciprocal unit cell vectors. In the first iteration numerical integration is carried out only in the outer region. Then in the inner region, where the singularity is located, the number of points is tripled and a second iteration proceeds as the first one, working now on the outer part of the inner region of the first iteration. By moving on in this fashion the algorithm triples the mesh size around the singularity in each iteration step. Therefore, the integration result is more accurate than with any regular mesh. We observe that less than 10 steps, depending on the lattice vectors considered, are sufficient to get the integral converged. The implementation of the described numerical integration is straightforward leading to about 200 lines of Fortran instructions. The computational time for carrying out the integration is negligible. Having considered in detail the treatment of the singularities in the exchange energy we now briefly present the corresponding treatment of singularities in the evaluation of the matrix elements of the non-local exchange potential, which is required in the HF selfconsistency process, or can be used in the construction of the local KS exchange potential 1,2 during the self-consistency process of a KS calculation. The matrix elements of the non-local exchange potential, v N L x (k, µ, ν), are given by v N L x (k, µ, ν) = - wq Ω drdr ′ χ µk (r ′ ) φ wq (r ′ )φ † wq (r) χ νk (r) |r -r ′ | (17) with χ µk and χ νk denoting the basis functions for the representation of the one-particle functions φ wq . The basis functions χ µk are products of a periodic part and a Bloch factor e -ik•r . The most common choice for the basis functions χ µk are plane waves e -i(G+k)•r . Like in the treatment of the exchange energy, we now express the products φ † wq (r) χ νk (r) as φ † wq (r) χ νk (r) = 1 Ω G Y wq,νk (G)e i(G+k-q)•r , (18) and obtain v N L x (k, µ, ν) = - 4π Ω wq G Y * wq,µk (G) Y wq,νk (G) |G + k -q| 2 , (19) Expression (  19 ) contains singular terms, again those with G = 0 and k = q. In the limit of an infinite number of unit cells the summation over q again turns into an integral, namely v N L x (k, µ, ν) = - 4π Ω Ω (2π) 3 w BZ dq G Y * wq,µk (G) Y wq,νk (G) |G + k -q| 2 , (20) with an integrable singularity. We can now treat the singular terms in the right hand side of (20) exactly analogously to the singular terms occuring in the exchange energy: - 4π Ω Ω (2π) 3 w BZ dq Y * wq,µk (0) Y wq,νk (0) |k -q| 2 = - 4π Ω Ω (2π) 3 w BZ dq Y * wq,µk (0) Y wq,νk (0) |k -q| 2 -Y * wk,µk (0) Y wk,νk (0) f (k -q) - w Y * wk,µk (0) Y wk,νk (0) 4π Ω Ω (2π) 3 BZ dq f (k -q) ≈ - 4π Ω w q =k Y * wq,µk (0) Y wq,νk (0) |k -q| 2 -Y * wk,µk (0) Y wk,νk (0) f (k -q) - w Y * wk,µk (0) Y wk,νk (0) 4π Ω Ω (2π) 3 BZ dq f (q) = - 4π Ω w q =k Y * wq,µk (0) Y wq,νk (0) |k -q| 2 + w Y * wk,µk (0) Y wk,νk (0) [ Fk -F ], (21) with Fk = 4π Ω q =k f (kq) and F = 4π (2π) 3 BZ dq f (kq). Thus, the matrix elements v N l x (k, µ, ν) of the non-local exchange potential can be evaluated by first omitting the singular terms in Eq. (  19 ) and by then adding the following correction term w Y * wk,µk (0) Y wk,νk (0) Fk -F . (22) The required sums Fk and the integral F have to be calculated only once at the beginning of the self-consistency procedure and then are multiplied by w Y * wk,µk (0) Y wk,νk (0) in each HF self-consistency cycle, because the Y * wk,µk (0) Y wk,νk (0) change during the self-consistency cycle. In case of a uniform grid of k points the Fk reduce to F given in Eq. (  14 ). The most widely used basis set for the one-particle functions of periodic systems are plane waves. If basis sets of plane waves are employed then the one-particle functions φ wq (r) are given by φ wq (r) = G C wq (G) 1 √ Ω e -i(G+k)•r . ( 23 ) The elements (19) of the non-local exchange potential turn into v N L x (k, G, G ′ ) = - 4π Ω wq G ′′ C wq (G -G ′ + G ′′ )C * wq (G ′′ ) |G ′ -G ′′ + k -q| 2 , (24) and the correction term (22) turns into w C wk (G)C * wk (G ′ ) Fk -F . ( 25 ) Again the matrix elements v N L x (k, G, G ′ ) can be calculated by first omitting the singular terms in Eq. (  24 ) and by then adding the correction term (25). So far we have considered only systems with bands that are either fully occupied or fully unoccupied., i.e. we have considered isolating systems at zero temperature. In the Appendix we sketch how the formulas of this Section change for systems with partially filled bands and how the singularities can be treated in this case.

III. RESULTS FOR DIAMOND AND TRANS -POLYACETYLENE
The applicability of the presented approach for treating the divergencies is now demonstrated by applying it to two cases, diamond and trans-polyacetylene, using different approximations for the exchange-correlation functionals: the Slater-Dirac (exchange-only LDA) referred to as Dirac exchange in the following, the complete exchange-correlation LDA in the parametrisation of Vosko, Wilk, and Nusair (VWN), 8 the combination of Dirac exchange plus Perdew86 9 (P86) correlation (P86 being VWN correlation plus a gradient correction), the EXX (exact-exchange only), and finally the combination of EXX with P86 correlation. The pseudopotentials were generated using the pseudopotential generation code of Engel,  26  which is based on the Troullier-Martins norm-conserving scheme.  27  In all cases the pseudopotentials were generated using consistently the same functionals for exchange and correlation as for the plane wave calculations. Relativistic effect are not included. The pseudopotentials of C are all constructed using a cutoff radius of 1.3 a.u. for both s and p levels. We constructed for the calculations of trans-polyacetylene chains hydrogen pseudopotentials with a cutoff radius of 0.9 a.u.. For diamond, the energy cutoff of the plane-wave basis is 60 Ry for the one-particle functions, and 20 Ry for the exchange potential and the response function 2 . For trans-polyacetylene,  28  we reduced the energy cutoffs to 32 Ry for the one-particle functions and 12 Ry for the exchange potential and the response function, because we are interested to determine the effect of the singularity function in terms of several possible k points meshes, and study meshes with a large number of k points. The lattice constants for diamond were varied from 3.1 to 4.1 Å. For comparison, the experimental lattice constant of diamond is 3.5668 Å.  11  Figure  1  shows the variation of the singularity correction of the EXX exchange energy as a function of the k point mesh for diamond. Fig.  2  shows the singularity correction for diamond for a fixed number of k points but for different volumes. Choosing 5 × 5 × 5 k points ensures convergence of the total energy within 0.2 eV, while 8 × 8 × 8 k points ensure total energy convergence within 0.05 eV. From Fig.  1  we notice that the singularity correction N v ( F -F ) and the exchange energy without the singularity correction vary oppositely with increasing number of k points. The complete exchange energy including the singularity correction turns out to be quite stable with the number of k points. Fig.  1  also shows that for small and medium numbers of k points a more symmetric mesh division reduces the deviation of the complete exchange energy from its converged value at high numbers of k points (compare dashed with continuous EXX line). Figure  2  also shows an aspect important for volume optimisations: the singularity correction changes dramatically with the volume and thus strongly modifies the position of the energy minimum as well as the bulk modulus. The energy minimum is reduced because the correction function is monotonically increasing with the volume. The bulk modulus is also modified because the variation of the correction is obviously not linear. The bulk modulus of diamond without the singularity correction is much smaller (25% smaller) than with it. Therefore, accurate integration of the singularity in the exchange energy is essential for evaluating bulk properties within EXX or HF methods. Fig.  3  shows volume optimisation results for diamond using the various combinations of exchange and correlation functionals. We observe that a removal of Coulomb self-interactions (see EXX versus Dirac exchange) induces a significant reduction of the total energy (∼2 eV). It also leads to a reduction of the lattice constant minimum [compare vertical lines in Fig.  3 ]. The values of both exchange-only energy curves, i.e., of the EXX and Dirac-Slater curves, are much higher than the curves that contain a correlation potential, i.e., the LDA, Dirac+P86, and EXX+P86 curves, which reflects that correlation affects the total energy. The reduction of the total energy from EXX to EXX-P86 is of the same order as the reduction from Diracexchange only to the Dirac exchange plus P86 correlation. However, the lattice constant minimum of the EXX-P86 is shifted to a much lower value than any other of the combinations of functionals. The reason for this maybe the reintroduction of self-interations, through the P86 correlation function. In any case, the poor performance of the combination EXX-P86 is not surprising because the P86 correlation is not meant to be used with the EXX, but rather with the LDA or GGA exchange in order to exploit error cancelations between exchange and correlation. Therefore, development of correlation functionals that do not depend on such error cancelations and thus are well-suited for combination with the EXX is highly desirable. The EXX energy optimised lattice equals 3.555 Å [see Fig.  3 ]. It becomes natural now to evaluate the band structure at the EXX energy minimum. Figure  4  shows the band structure at this EXX energy minimum. The indirect EXX bandgap is 4.838 Å, a value comparable to previous published data, 2 and much closer to the experimental band gap of 5.50 eV  11  than the LDA value of 3.90 eV.  29  The experimental lattice constant of diamond  11  (3.5668 Å) is slightly larger (+0.011 Å) than the EXX energy optimised lattice. Going from the EXX lattice minimum to the experimental value, i.e., addition of 0.011 Å to the EXX lattice constant, leads to minute reduction of the band gap. However, we want to emphasize that the singularity correction to the exchange energy is obviously essential for determining the right correspondence between the EXX energy lattice minimum [Fig.  3 ] and the band structure or its band gap [Fig.  4 ]. For instance, without the singularity correction the EXX lattice energy minimum would be incorrectly overestimated (3.730 Å instead of 3.555 Å as illustrated in Fig.  3 ), and the EXX band gap correspondingly would be largely underestimated (because the band gap variation is roughly inversely proportional to the lattice constant). In summary, we find that for diamond the EXX band gap is somewhat smaller than in the experiments (0.66 eV lower than experiment), but EXX improves significantly the LDA value (∼1.6 eV lower than experiment). As mentioned in the introduction, the EXX calculation does not account for the derivative discontinuity  12, 13  of the band gap at integer electron numbers and, of course, also not for the correlation potential. We now consider a more general crystal structure: trans-polyacetylene. The unit cell is constituted of 4 carbons and 4 hydrogens. More data on the band structure of transpolyacetylene can be found elsewhere.  28  Trans-polyacetylene constitutes a monoclinic lattice structure (group P 2 1 /a) with the following lattice parameters expressed in cartesian coordinates (and in Å): a 1 = (4.24, 0.00, 0.00) a 2 = (-0.0642644, 2.454158, 0.00) (26) a 3 = (0.00, 0.00 The angle between a 1 and a 2 is 91.46 • . The angle between any two dimerised chains is 55 • . The coordinates of the structurally optimised hydrogen atoms come from Hartree-Fock calculations and the lattice parameters and C-C bond distances and angles come from experimental values.  30  This structure constitutes a general and realistic case to test our singularity correction for several k points meshes. A graph equivalent to Fig.  1  is displayed in Fig.  5  for this molecular crystal. Figure  5  shows for trans-polyacetylene a similar trend as shown in Fig.  1  for diamond. That is, the singularity correction and the exchange energy excluding the singularity vary in opposite matter, for any chosen k points division. The complete exchange energy is a rather monotonic function of the total number of k points in the unit cell. The results, both for diamond and trans-polyacetylene, show that the approach presented here to treat the integrable singularities in the KS and HF methods constitutes a stable and general scheme.

IV. CONCLUDING REMARKS
We have presented a general scheme for treating the integrable singularities of the exchange energy within the EXX or the HF formalisms. We have shown that the divergent terms in the exchange energy depend only on the number and positions of k points and on the unit cell vectors and thus on the unit cell volume, but not on the single particle wave functions or on the particular atomic positions within the unit cell. A similar correction procedure is proposed for matrix elements of the non-local exchange operator which occurs in the Hartree-Fock methods and can be used to construct the exact local Kohn-Sham exchange potential. We applied the singularity correction to a typical symmetric structure, diamond, and to a more general structure, trans-polyacetylene, and discussed the effect of the singularity function on volume optimisation and k points convergence. The singularity function depends strongly on the total number of k points and more weakly on the choice of the specific division of the k points mesh. The complete, i.e., singularity corrected exchange energy, converges well with the number of k points. The method proposed here constitutes a stable, simple to implement, and general scheme that can be applied to systems with any lattice parameters within either the EXX Kohn-Sham or the Hartree-Fock formalism. V. ACKNOWLEDGMENTS 

VI. APPENDIX
In this Appendix we briefly consider the treatment of singularities for systems with partially filled bands. In this case expression (3) for the exchange energy turns into E x = - 1 N k occ. vk occ. wq η vk η wq Ω dr Ω dr ′ φ † vk (r)φ wq (r)φ † wq (r ′ )φ vk (r ′ ) |r -r ′ | , (27) with the occupation factor η vk . The occupation factor shall not include the spin multiplicity, i.e., 0 ≤ η vk ≤ 1. Analogously to Eq. (  6 ) the exchange energy can be expressed by E x = - 4π N k Ω vk wq η vk η wq G Y * wq,vk (G) Y wq,vk (G) |G + k -q| 2 , ( 28 ) The singular terms in expression (28), namely those with G = 0, k = q, and v = w, can be treated in analogy to Eq. (  10 ) according to - 4π N k Ω Ω 2 (2π) 6 v BZ dk BZ dq η vq η vk Y * vq,vk (0) Y vq,vk (0) |k -q| 2 = - 4π N k Ω Ω 2 (2π) 6 v BZ dk BZ dq η vq η vk Y * vq,vk (0) Y vq,vk (0) |k -q| 2 -η 2 vk f (k -q) - 4π N k Ω Ω 2 (2π) 6 v BZ dk BZ dq η 2 vk f (k -q) ≈ - 4π N k Ω v k q =k η vq η vk Y * vq,vk (0) Y vq,vk (0) |k -q| 2 -η 2 vk f (k -q) - 4π N k Ω Ω 2 (2π) 6 v BZ dk η 2 vk BZ dq f (q) = - 4π N k Ω v k q =k η vq η vk Y * vq,vk (0) Y vq,vk (0) |k -q| 2 + 1 N k k v η 2 vk 4π Ω q =k f (k -q) - Ω (2π) 3 N k v BZ dk η 2 vk 4π (2π) 3 BZ dq f (q) ≈ - 4π N k Ω v k q =k η vq η vk Y * vq,vk (0) Y vq,vk (0) |k -q| 2 + 1 N k v k η 2 vk Fk - 1 N k v k η 2 vk 4π (2π) 3 BZ dq f (q) = - 4π N k Ω v k q =k η vq η vk Y * vq,vk (0) Y vq,vk (0) |k -q| 2 + 1 N k v k η 2 vk Fk - 1 N k v k η 2 vk F, (29) with Fk = 4π Ω q =k f (qk) and F = -4π (2π) 3 BZ dq f (kq). In Eq. (  29 ) we have used that the integral BZ dk η 2 vk does not contain any singularities and therefore can be evaluated via summation over the k points. The energy again can be evaluated by first omitting the singular terms in Eq. (  28 ) and by then adding the correction term 1 N k k v η 2 vk Fk - 1 N k v k η 2 vk F. (30) For the particular case of a uniform grid of k points the functions Fk all equal the function F of Eq. (  12 ) and the correction term turns into 1 N k v k η 2 vk [ F -F ] . (31) In a similar way as the treatment of the singularities in the exchange energy was generalized for the case of partially occupied bands also the treatment of the singularities in the exchange potential can be generalized to the case of partially occupied bands. The matrix elements of the non-local exchange potential, v N L x (k, µ, ν), then are given by v N L x (k, µ, ν) = - 4π Ω wq η wq G Y * wq,µk (G) Y wq,νk (G) |G + k -q| 2 , (32) Expression (32) contains singular terms, i.e., those with G = 0 and k = q. In the limit of an infinite number of unit cells the summation over q again turns into an integral, namely v N L x (k, µ, ν) = - 4π Ω Ω (2π) 3 w BZ dq η wq G Y * wq,µk (G) Y wq,νk (G) |G + k -q| 2 . ( 33 ) with an integrable singularity. We can now treat the singular terms in the right hand side of (33) exactly analogously to the singular terms occuring in the exchange energy:  - 4π Ω Ω (2π) 3 w BZ dq η wq Y * wq,µk (0) Y wq,νk (0) |k -q| 2 = - 4π Ω Ω (2π) 3 w BZ dq η wq Y * wq,µk (0) Y wq,νk (0) |k -q| 2 -η wk Y * wk,µk (0) Y wk,νk (0) f (k -q) - w η wk Y * wk,µk (0) Y wk,νk (0) 4π Ω Ω (2π) 3 BZ dq f (k -q) ≈ - 4π Ω w q =k η wq Y * wq,µk (0) Y wq,νk (0) |k -q| 2 -η wk Y * wk,µk (0) Y wk,νk (0) f (k -q) - w η wk Y * wk,µk (0) Y wk,νk (0) 4π Ω Ω (2π) 3 BZ dq f (q) = - 4π Ω w q =k η wq Y * wq,µk (0) Y wq,νk (0) |k -q| 2 + w η wk Y * wk,µk ( The required sums Fk and the integral F have to be calculated only once at the beginning of the self-consistency procedure and then multiplied by w η wk Y * wk,µk (0) Y wk,νk (0) in each HF self-consistency cycle, because the Y * wk,µk (0) Y wk,νk (0) and the occupation numbers η wk change during the self-consistency cycle. In case of a uniform grid of k points the Fk reduce to F given in Eq. (  14 ), as for fully occupied bands (since the singularity function f (q) does not depend on the occupation numbers η wk ). If basis sets of plane waves are employed then the elements (32) of the non-local exchange potential turn into v N L x (k, G, G ′ ) = - 4π Ω wq η wq G ′′ C wq (G -G ′ + G ′′ )C * wq (G ′′ ) |G ′ -G ′′ + k -q| 2 , ( 36 ) and the correction term (35) turns into w η wk C wk (G)C * wk (G ′ ) Fk -F . (37) Again the matrix elements v N L x (k, G, G ′ ) can be calculated by first omitting the singular terms in Eq. (36) and by then adding the correction term (37).     