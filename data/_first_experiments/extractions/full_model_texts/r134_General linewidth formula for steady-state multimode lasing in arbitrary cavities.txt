The intrinsic linewidth of a laser arises from quantum fluctuations and would be zero in the absence of spontaneous emission. It is the most important property of lasers which arises from the quantization of the electromagnetic field. Its value depends on the properties of the specific laser cavity and gain medium, and was first calculated in the seminal work of Schawlow and Townes (ST), who found the famous linewidth formula 
[1]   δω ST = ω 0 γ 2 c 2P , (1) where ω 0 is the frequency of the laser mode, γ c is the linewidth of the relevant passive cavity resonance, and P is the modal output power. Note that in this formula the properties of the gain medium are absent. Improved theoretical analyses over the next several decades found three multiplicative corrections to the ST formula, all of which tended to increase the linewidth, in some cases by large factors  [2, 3] . One correction factor arises from incomplete inversion of the gain medium, and a second one from indirect phase fluctuations due to the instantaneous intensity change caused by spontaneous emission (the Henry α factor)  [3] . The third correction and the main focus of this Letter is the Petermann factor, K. First discovered in the context of transverse gain-guided semiconductor lasers  [4]  and subsequently generalized  [2, [5] [6] [7] [8] [9] [10] , this factor arises from the non-Hermitian nature of the laser wave equation, due to the presence of the gain medium as well as the openness of the laser cavity (i.e. spatially non-uniform outcoupling loss). It always leads to an enhancement of the linewidth, even with uniform gain and no gain-guiding. Typically, it is calculated from the non-orthogonal passive cavity resonances as K = dr |ϕ(r)| 2 dr ϕ(r) 2 2 , (2) where the integrals are taken over the cavity  [11] . In effect, the Petermann factor changes the ST linewidth by the replacement γ 2 c → Kγ 2 c . This is a significant correction for lasers with large outcoupling, in the range 1.1-1.6 for the conventional semiconductor lasers studied in Ref.  [2] . We shall refer to the standard theory, inclusive of the Petermann factor, as the Schawlow-Townes-Petermann (STP) theory. The extensive and impressive literature on the Petermann factor  [2, [4] [5] [6] [7] [8] [9] [10] 12 ] has, with one major exception  [9] , only treated single-mode lasing near threshold, neglecting the effects of spatial hole-burning. And apart from a recent paper by Schomerus  [12] , the literature has exclusively treated one-dimensional or waveguide lasers, and thus is not directly applicable to the wide variety of complex laser cavities developed during the past twenty years, such as microdisk and deformed-disk, photonic crystal, and random lasers. In this Letter, we derive a general formula for the intrinsic laser linewidth in arbitrary cavities, which is valid far from threshold, with strong spatial hole-burning, and in the multimode regime. The formula relates the linewidth to a non-linear self-consistent scattering matrix (S-matrix), and is based on the recently-developed Steady-state Ab initio Laser Theory (SALT)  [13] [14] [15] [16] . SALT is a method for solving the steady-state properties of arbitrary lasing structures, without directly integrating the semiclassical laser equations. "Semiclassical" here refers to the fact that the field is treated via the classical Maxwell equations, whereas the properties of the gain medium are obtained from a quantum-mechanical calculation of a multi-level atom. SALT treats the openness of the cavity exactly, and the non-linear modal interactions and gain saturation are included to infinite order. Its results agree well with numerical integration of the laser equations, but it is computationally much more efficient  [17, 18] . It has been applied to complex laser struc-tures such as random  [15]  and photonic crystal lasers  [19] . We shall show that the quantum input-output theory of Refs.  [20, 21]  can be used to calculate quantum fluctuation properties ab initio, in terms of quantities obtainable from SALT. SALT associates each laser mode with a scattering pole-an eigenstate of a classical nonlinear Smatrix with infinite eigenvalue-at a real frequency. We derive a formula for the linewidths of a multimode laser in terms of the residues of these poles and a certain norm of the lasing eigenstate. For a low-Q cavity, the generalized linewidth formula typically finds substantial deviations from the STP prediction: typically the linewidth is significantly less than the standard theory predicts, and in the random laser example shown below, the laser has an anomalous power-dependence near threshold. The multimode SALT equations are  [16] : ∇ 2 + c ( r) + γ ⊥ D( r) ω µ -ω a + iγ ⊥ ω 2 µ Ψ µ ( r) = 0, D( r) = D 0 ( r) 1 + n ν=1 Γ ν |Ψ ν ( r)| 2 -1 , (3) where Ψ µ is the µ th steady-state lasing mode, ω µ is its frequency, c is the passive cavity dielectric function, ⊥ is the gain medium linewidth, ω a is the atomic transition frequency, D 0 ( r) is the (possibly spatially-varying) pump, and Γ ν ≡ γ 2 ⊥ /(γ 2 ⊥ + (ω ν -ω a ) 2 ) is the gain curve. The effective pump D( r) contains an infiniteorder nonlinear "hole-burning" term, which gives rise to mode competition and gain saturation in a quantitatively precise manner. These coupled, time-independent, nonlinear equations are solved with the boundary condition of purely outgoing waves with frequency ω µ at infinity; the solution algorithm is discussed in Refs.  [15, 16, 18] . From the solution to (3), we can compute a selfconsistent S-matrix for any complex frequency ω, not just the discrete lasing frequencies ω µ  [22] . By definition, this S-matrix has one or more poles on the real-ω axis, at ω = ω µ . It can be used to study the effects of vacuum fluctuations and spontaneous emission  [23] . Suppose the cavity has scattering channels indexed by j = 1, 2, . . . , N (e.g. waveguide modes or spherical waves, depending on the scattering geometry). The input and output photon operators, denoted by a 1 , . . . , a N and b 1 , . . . , b N respectively, obey an "input-output" relation  [24] : b i (Ω) = j S ij (Ω) a j (Ω) + ρ V iρ (Ω) d † ρ (-Ω). ( 4 ) Here the frequency Ω is measured from the lasing frequency of interest, which we denote by ω 0 , Ω ≡ ω -ω 0 . The d ρ 's are ladder operators for the external reservoirs corresponding to the gain medium, with the index ρ denoting appropriate degrees of freedom in the cavity/reservoir  [25] . In order for a, b, and d to obey canonical commutation relations, e.g. [a i (Ω), a j (Ω )] = δ ij δ(Ω-Ω ), the S-matrix must be related to the reservoir coupling coefficients by the fluctuation-dissipation relation  [24]  SS † -V V † = 1, (5) where 1 is the N × N identity matrix. Next, we define a j (t) = 1 √ 2π dΩ a j (Ω) e -iΩt , (6) and similarly for b j (t) and d ρ (t), describing quantum amplitudes for the field envelopes. Inserting into (4) gives b i (t) = dt k dΩ 2π S ik (Ω) e -iΩ(t-t ) a k (t ) + dt ρ dΩ 2π V iρ (Ω) e -iΩ(t-t ) d † ρ (t ). (7) The first term describes scattering of input photons, and the second describes emission from the gain medium. S is strongly constrained by its symmetries. Firstly, optical reciprocity  [26]  implies that S can be written as a symmetric matrix, so it has the eigenvalue decomposition S = n |ψ n s n ψ * n |ψ n ψ * n |, (8) where each |ψ n denotes a right eigenvector of S with eigenvalue s n , and ψ * n | denotes its unconjugated transpose. These eigenvectors are bi-orthogonal ( ψ * m |ψ n = 0 for m = n) and power-normalized ( ψ n |ψ n = 1). Suppose that c (r) is real. The S-matrix of the passive cavity is unitary, and for a high-Q cavity with a resonance near ω 0 , one of the eigenvalues is approximately  [27] : s 0 (Ω) ≈ e iϕ(Ω) Ω -iγ c /2 Ω + iγ c /2 , where ϕ is an irrelevant phase factor and γ c is the cavity lifetime. The eigenvalue is unimodular for real Ω, and, as required by time-reversal symmetry, its poles and zeros lie at conjugate positions in the complex Ω plane. Adding gain pushes the zero and pole up in the complex frequency plane. The eigenvalue takes the form s 0 (Ω) ≈ e iϕ (Ω) Ω -iΓ z Ω + iΓ p , (9) where Γ z and Γ p are the distances of the zero and pole from the real axis. The lasing threshold is reached as Γ p → 0 -; within the high-Q approximation the eigenvalue takes the form  (9)  with Γ z ≈ γ c (the zero moves up the same distance as the pole). This approximation leads directly to the ST formula (high Q will imply K ≈ 1). For arbitrary Q, the S-matrix near Ω = 0 takes the form  (9) , with a generalized residue Γ L (Ω) replacing Ω -iΓ z . We denote the eigenvector corresponding to this diverging eigenvalue by Ψ. In the S-matrix decomposition (8), the term with s 0 dominates, so we can write S ≈ |Ψ s 0 Ψ * |Ψ Ψ * |. ( 10 ) Using this together with Eq. (  5 ) gives V V † ≈ |Ψ 1 |Ψ T Ψ| 2 |Γ L | 2 Ω 2 + Γ 2 p Ψ|. ( 11 ) This equation is satisfied by the ansatz V iρ = 1 Ψ T L Ψ L Γ L Ω + iΓ p Ψ i L u ρ , ( 12 ) where u is some vector satisfying ρ u † ρ u ρ = 1, and Ψ i L , is the i th component of the S-matrix eigenvector for the lasing mode. Note that this relation applies not just to the first lasing mode at threshold, but also for above-threshold steady-state lasing modes, using the selfconsistent, non-linear S-matrix obtained from SALT. Inserting (  12 ) into (  7 ) and performing the resulting contour integrals gives b i (t) = - Γ L Ψ i L Ψ T L Ψ L t dt e -Γp(t-t ) F (t ) (13) F (t) ≡ j Ψ Lj a j (t) + i ρ u ρ d † ρ (t). (14) Thus each output photon is a superposition of incoming photons and reservoir excitations from all earlier times. Above threshold, the gain medium undergoes stimulated emission, and the laser field acquires a mean value, B i , so that Eq. (13 becomes: b i (t) = B i - Γ L Ψ i L Ψ T L Ψ L t dt e -Γp(t-t ) F (t ), (15) where B i , the steady-state classical outgoing field amplitude in channel i, is related to Ψ i L by |B i | 2 = P ω 0 Ψ i L 2 ( 16 ) where P is the total output power of the mode. Due to the fluctuation operator F (t), the phase of the output field has a quantum uncertainty; the rate at which this uncertainty increases with time gives the laser coherence time scale. The fluctuation-induced phase changes are fed back into the classical value of B i , causing a random drift in the phase of the laser field. We ignore this feedback, instead taking a fixed value for B i for all t. This is justifiable because the integrand in  (15)  vanishes exponentially for t -T , where T = 1/Γ p will turn out to be the coherence time. The calculations below apply to times much shorter than T . We choose the arbitrary global phase of B i to be real and positive for the specific channel i, and study the quantum fluctuations of the phase via the Hermitian quadrature operator  [29]   θ i = i(b † i -b i ) 2B i , (17) which for small phase angles corresponds to the phase of the laser output in channel i. Using (  14 ) and (  15 ), we compute the quantity θ i (t 1 )θ i (t 2 ) , taking a = d = a † i (t 1 ) a j (t 2 ) = 0 and taking the white noise correlator d ρ (t 1 ) d † ν (t 2 ) = f ρ δ ρν δ(t 1 -t 2 ), (18) where f ρ = [P 2 /(P 2 -P 1 )] ρ describes the local population inversion  [24] . The zero-point contributions to θ i (t 1 )θ i (t 2 ) from the photon input and the gain medium cancel exactly, leaving FIG.  2:  (color online) Laser linewidth vs. inverse modal output power 1/P , for the two lasers studied in Fig.  1 . The linewidths are computed using Eq. (  21 ), assuming the inversion factor f = 1. (a) The high-Q cavity laser linewidths show the standard 1/P dependence for both modes. (b) θ i (t 1 )θ i (t 2 ) = |Γ L | 2 |Ψ T L Ψ L | 2 ω 0 4Γ p P e -Γp|t1-t2| f , (19) The linewidth of the first mode of the random laser deviates strongly from the 1/P Schawlow-Townes-Petermann dependence at lower pump values. At large pump values the linewidths of both mode 1 (solid curve) and mode 2 (dashed curve) vary as 1/P , but with values roughly half that of the standard STP prediction (dotted curve). where P is the modal output power from Eq. (  16 ), and f ≡ ρ f ρ |u ρ | 2 (20) is the inversion factor correction mentioned at the beginning of this Letter. The phase uncertainty accumulated over time ∆t is [θ i (t + ∆t) -θ i (t)] 2 = ∆ω∆t + O(∆t 2 ), where ∆ω = |Γ L | 2 |Ψ T L Ψ L | 2 ω 0 2P f ≡ ω 0 γ 2 L 2P f (21) This is our central result: a general linewidth formula in which |Γ L | 2 /|Ψ T L Ψ L | 2 ≡ γ 2 L replaces the quantity Kγ 2 c in the conventional Schawlow-Townes-Petermann linewidth formula. We can think of γ L as a generalized cavity decay rate, corrected for the presence of gain, openness, holeburning, and saturation. It is calculable ab initio, with no phenomenological parameters, from the non-linear classical S-matrix of SALT. The lasing eigenvector is found by diagonalizing the S-matrix at each lasing pole, and the residue Γ L is found by numerically integrating the relevant eigenvalue of the S-matrix around the pole. Eq. (  21 ) only includes the contribution to the laser linewidth from direct phase fluctuations; the indirect phase fluctuations  [3]  have been omitted for simplicity. The relation of the Petermann factor to the residue of the lasing pole for a waveguide laser was emphasized early on by Henry  [6] , and developed for more general cavities in an S-matrix formulation in Refs.  [12, 30] , but in all previous cases for a single lasing mode at threshold, i.e. without non-linear effects. Goldberg et al.  [9]  gave an excellent and detailed analysis of the linewidth for multimode lasing, including non-linear effects, but using an approach applicable only to one-dimensional cavities with spatially uniform dielectric functions. To our knowledge, our Eq. (  21 ), combined with SALT, is unique in providing a quantitative method for calculating the intrinsic laser linewidth in arbitrary cavities and pump profiles in the multimode, non-linear regime. Assuming steady-state multimode lasing exists, the present theory makes no significant further approximations, and hence it can be used to evaluate the validity of the STP linewidth formula  [2] . We can connect Eq. (  21 ) to previous results involving quasi-modes, such as Refs.  [4, 5, 7] , by examining the S-matrix of a passive cavity. A quasimode ϕ(r) is a purely-outgoing solution to the wave equation for a passive cavity with dielectric function (r), at complex frequency ω p , where Im(ω p ) ≡ -γ c /2. Let Ψ be the Smatrix eigenvector for this pole, normalized by Ψ † Ψ = 1, and let Γ be the residue of the eigenvalue. It can be shown that [22] Im ω 2 p dr (r) |ϕ(r)| 2 = -Re[ω p ], (22) (r) ϕ 2 (r) = i Γ - i 2ω p Ψ T Ψ. ( 23 ) Here the spatial integrals are taken over the cavity. For real (r), and in the limit |k p | Γ ∼ γ c , (22)-(23) give |Γ| 2 |Ψ T Ψ| 2 ≈ dr (r) |ϕ(r)| 2 dr (r) ϕ(r) 2 2 γ 2 c = Kγ 2 c . (24) Thus, in this slightly generalized version, Kγ 2 c is approximately equal to our γ 2 L , when evaluated for the passive cavity. Note that both  (24)  and its active-cavity generalization in Ref.  [12]  do not include the effects of dielectric dispersion, which can have a significant effect on γ 2 L . Fig.  1 compares γ 2  L to Kγ 2 c for two one-dimensional microcavity multimode lasers: a high-Q, uniform cavity for which the two quantities agree rather well, and a low-Q random laser, for which major deviations are found. For the random laser, at pump strengths up to four times threshold, γ L for the first lasing mode depends strongly on P , causing the overall power dependence to depart substantially from the standard 1/P dependence (Fig.  2 ). For higher pump strengths, γ L is approximately constant, but the conventional linewidth prefactor Kγ 2 c overestimates it by almost a factor of two. In the standard theory, the STP linewidth is expected to be a lower bound set by field quantization, but insofar as the usual STP formula relies on passive cavity quantities it is not a reliable bound. Analysis of our results indicates that this deviation from the STP theory arises from low cavity Q and from the frequency dispersion of the dielectric constant of the gain medium, which cause a significant reduction of the residue of the lasing pole at threshold compared to its value in the passive cavity. We do not believe that the apparent violation of the STP bound indicates any new quantum fluctuation properties of the laser. In future work, our generalized linewidth formula will allow such issues to be studied systematically. This research was partially supported by NSF grant No. DMR-0908437, and by NRF (Singapore) grant No. NRFF2012-02. The authors would like to thank H. Cao, M. Devoret, and H. Schomerus for helpful discussions.